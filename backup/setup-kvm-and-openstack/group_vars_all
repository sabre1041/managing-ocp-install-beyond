#!/bin/bash

# Set variables
VERBOSE=true
DEBUG=false
LAB_NAME=L104353
BASE_DOMAIN=example.com
ADMIN_DOMAIN=admin.${BASE_DOMAIN}
OSP_DOMAIN=osp.${BASE_DOMAIN}
WILDCARD_DOMAIN=".apps.${BASE_DOMAIN}"
SSH_KEY_FILENAME=~/.ssh/${LAB_NAME}
SSH_OPTS="-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i ${SSH_KEY_FILENAME}"
PASSWORD=summit2017
TIMEOUT=180
FILESHARE_DEST_BASE=/fileshare/scripts/summit2017
: ${FILESHARE_HOST:=10.11.169.10}
: ${UPDATE_FILESHARE:=true}
: ${USE_FILESHARE:=true}
: ${REFRESH_BUILD:=false}

declare -A VM_RAM=([rhosp]=49152 [tower]=8192 [repo]=2048)
declare -A VM_VCPUS=([rhosp]=8 [tower]=2 [repo]=1)
declare -A VM_IP=([rhosp]=172.20.17.10 [tower]=172.20.17.20 [repo]=172.20.17.15)

# Base URL to use for fetching pre-created disk images
VM_IMAGE_URL_BASE=http://${FILESHARE_HOST}${FILESHARE_DEST_BASE}
IMAGE_STAGING_DIR=/tmp
IMAGE_LOCAL_DIR=/var/lib/libvirt/images

OSP_NAME=rhosp
OSP_VM_NAME=${LAB_NAME}-${OSP_NAME}
OSP_VM_IMAGE_NAME=${OSP_VM_NAME}.qcow2
OSP_VM_IMAGE_PATH=${IMAGE_LOCAL_DIR}/${OSP_VM_IMAGE_NAME}
OSP_VM_HOSTNAME=${OSP_NAME}.${ADMIN_DOMAIN}
OSP_VM_TOTAL_DISK_SIZE=100G
OSP_VM_ROOT_DISK_SIZE=15G
OSP_BASE_IMAGE_NAME=rhel-guest-image-7.3-35.x86_64.qcow2
OSP_BASE_IMAGE_URL=http://${FILESHARE_HOST}/fileshare/images/${OSP_BASE_IMAGE_NAME}
OSP_BASE_IMAGE_PATH=${IMAGE_STAGING_DIR}/${OSP_BASE_IMAGE_NAME}

REPO_NAME=repo
REPO_VM_NAME=${LAB_NAME}-${REPO_NAME}
REPO_VM_IMAGE_NAME=${REPO_VM_NAME}.qcow2
REPO_VM_IMAGE_PATH=${IMAGE_LOCAL_DIR}/${REPO_VM_IMAGE_NAME}
REPO_VM_HOSTNAME=${REPO_NAME}.${ADMIN_DOMAIN}
REPO_VM_TOTAL_DISK_SIZE=100G
REPO_VM_ROOT_DISK_SIZE=100G
REPO_BASE_IMAGE_NAME=rhel-guest-image-7.3-35.x86_64.qcow2
REPO_BASE_IMAGE_URL=http://${FILESHARE_HOST}/fileshare/images/${REPO_BASE_IMAGE_NAME}
REPO_BASE_IMAGE_PATH=${IMAGE_STAGING_DIR}/${REPO_BASE_IMAGE_NAME}

TOWER_PRIVATE_KEY=${LAB_NAME}-tower.pem
TOWER_PRIVATE_KEY_URL=http://${FILESHARE_HOST}${FILESHARE_DEST_BASE}/${LAB_NAME}-tower/tower_host
TOWER_PUBLIC_KEY=${LAB_NAME}-tower.pub
TOWER_PUBLIC_KEY_URL=http://${FILESHARE_HOST}${FILESHARE_DEST_BASE}/${LAB_NAME}-tower/tower_host.pub

OPENSHIFT_NAME=openshift-base
OPENSHIFT_VM_NAME=${OPENSHIFT_NAME}
OPENSHIFT_IMAGE_NAME=${LAB_NAME}-${OPENSHIFT_NAME}.qcow2
OPENSHIFT_IMAGE_URL=http://${FILESHARE_HOST}${FILESHARE_DEST_BASE}/${LAB_NAME}-openshift-base/${OPENSHIFT_IMAGE_NAME}
OPENSHIFT_IMAGE_PATH=${IMAGE_STAGING_DIR}/${OPENSHIFT_IMAGE_NAME}
OPENSHIFT_VM_HOSTNAME=${OPENSHIFT_NAME}.${OSP_DOMAIN}

# Load common functions
source openstack-scripts/common-libs
source common-deploy-functions
